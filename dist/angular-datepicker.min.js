"use strict";!function(a){var b=a.module("datePicker",[]);b.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),b.filter("mFormat",function(){return function(a,b,c){return moment.isMoment(a)?c?moment.tz(a,c).format(b):a.format(b):moment(a).format(b)}}),b.directive("datePicker",["datePickerConfig","datePickerUtils",function(b,c){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(d,e,f,g){function h(){d.views=b.views.concat(),d.view=f.view||b.view,d.views=d.views.slice(d.views.indexOf(f.maxView||"year"),d.views.indexOf(f.minView||"minutes")+1),1!==d.views.length&&-1!==d.views.indexOf(d.view)||(d.view=d.views[0])}function i(a){return c.getDate(d,f,a)}function j(a){a&&(d.model=a,g&&g.$setViewValue(a)),d.$emit("setDate",d.model,d.view),d.callbackOnSetDate&&d.callbackOnSetDate(f.datePicker,d.date)}function k(){var a=d.view;c.setParams(s),d.model&&!r&&(d.date=t(d.model),r=!1);var b=d.date;switch(a){case"year":d.years=c.getVisibleYears(b);break;case"month":d.months=c.getVisibleMonths(b);break;case"date":d.weekdays=d.weekdays||c.getDaysOfWeek(),d.weeks=c.getVisibleWeeks(b);break;case"hours":d.hours=c.getVisibleHours(b);break;case"minutes":d.minutes=c.getVisibleMinutes(b,v)}m()}function l(){return"date"!==d.view?d.view:d.date?d.date.month():null}function m(){var a,e,f=d.view,g=d.date,h=[],i="";if(c.setParams(s),"date"===f){var j,k=d.weeks;for(a=0;a<k.length;a++)for(j=k[a],h.push([]),e=0;e<j.length;e++)i="",c.isSameDay(g,j[e])&&(i+="active"),q(j[e],f)&&(i+=" now"),j[e].month()===g.month()&&n(j[e])||(i+=" disabled"),h[a].push(i)}else{var l=b.viewConfig[f],m=d[l[0]],o=l[1];for(a=0;a<m.length;a++)i="",c[o](g,m[a])&&(i+="active"),q(m[a],f)&&(i+=" now"),n(m[a])||(i+=" disabled"),h.push(i)}d.classes=h}function n(a){var b=!0;return x&&x.isAfter(a)&&(b=o(x,a)),y&&y.isBefore(a)&&(b&=o(y,a)),b}function o(a,c){return!!a.isSame(c,b.momentNames[d.view])}function p(a){return x&&x.isAfter(a)?x:y&&y.isBefore(a)?y:a}function q(a,b){var c=!0;switch(b){case"minutes":c&=~~(A.minutes()/v)==~~(a.minutes()/v);case"hours":c&=A.hours()===a.hours();case"date":c&=A.date()===a.date();case"month":c&=A.month()===a.month();case"year":c&=A.year()===a.year()}return c}c.setParams(f.timezone);var r=!1,s=d.tz=f.timezone,t=c.createMoment,u=c.eventIsForPicker,v=parseInt(f.step||b.step,10),w=!!f.partial,x=i("minDate"),y=i("maxDate"),z=e[0].id,A=d.now=t(),B=d.date=t(d.model||A),C="true"===f.autoClose;d.model||B.minute(Math.ceil(B.minute()/v)*v).second(0),d.template=f.template||b.template,d.watchDirectChanges=void 0!==f.watchDirectChanges,d.callbackOnSetDate=f.dateChange?c.findFunction(d,f.dateChange):void 0,h(),d.setView=function(a){-1!==d.views.indexOf(a)&&(d.view=a)},d.selectDate=function(a){if(f.disabled)return!1;if(o(d.date,a)&&(a=d.date),!(a=p(a)))return!1;d.date=a;var b=d.views[d.views.indexOf(d.view)+1];(!b||w||d.model)&&j(a),b?d.setView(b):C?(e.addClass("hidden"),d.$emit("hidePicker")):m()},d.$watch(l,k),d.watchDirectChanges&&d.$watch("model",function(){r=!1,k()}),d.next=function(a){var b=moment(d.date);switch(a=a||1,d.view){case"year":case"month":b.year(b.year()+a);break;case"date":b.month(b.month()+a);break;case"hours":case"minutes":b.hours(b.hours()+a)}(b=p(b))&&(d.date=b,j(b),r=!0,k())},d.prev=function(a){return d.next(-a||-1)},z&&d.$on("pickerUpdate",function(b,c,d){if(u(c,z)){var e=!1,g=!1;a.isDefined(d.minDate)&&(x=!!d.minDate&&d.minDate,g=!0),a.isDefined(d.maxDate)&&(y=!!d.maxDate&&d.maxDate,g=!0),a.isDefined(d.minView)&&(f.minView=d.minView,e=!0),a.isDefined(d.maxView)&&(f.maxView=d.maxView,e=!0),f.view=d.view||f.view,e&&h(),g&&k()}})}}}]),a.module("datePicker").factory("datePickerUtils",function(){var b,c=function(a,c,d,e,f){var g=Date.UTC(0|a,0|c,0|d,0|e,0|f);return b?moment.tz(g,b):moment(g)};return{getVisibleMinutes:function(a,b){var d,e,f=a.year(),g=a.month(),h=a.date(),i=a.hours(),j=a.utcOffset()/60,k=[];for(e=0;e<60;e+=b)d=c(f,g,h,i-j,e),k.push(d);return k},getVisibleWeeks:function(a){a=moment(a);var b=a.year(),c=a.month();a.date(1);var d=a.day();0===d?a.date(-6):a.date(1-d);for(var e=[];e.length<6&&!(a.year()===b&&a.month()>c);)e.push(this.getDaysOfWeek(a)),a.add(7,"d");return e},getVisibleYears:function(a){var b=moment(a),d=b.year();b.year(d-d%10),d=b.year();for(var e,f,g=b.utcOffset()/60,h=[],i=0;i<12;i++)e=c(d,0,1,0-g),f=e.utcOffset()/60,f!==g&&(e=c(d,0,1,0-f),g=f),h.push(e),d++;return h},getDaysOfWeek:function(a){a=a||(b?moment.tz(b).day(0):moment().day(0));for(var d,e,f=a.year(),g=a.month(),h=a.date(),i=[],j=a.utcOffset()/60,k=0;k<7;k++)d=c(f,g,h,0-j,0,!1),e=d.utcOffset()/60,e!==j&&(d=c(f,g,h,0-e,0,!1)),i.push(d),h++;return i},getVisibleMonths:function(a){for(var b,d,e=a.year(),f=a.utcOffset()/60,g=[],h=0;h<12;h++)b=c(e,h,1,0-f,0,!1),d=b.utcOffset()/60,d!==f&&(b=c(e,h,1,0-d,0,!1)),g.push(b);return g},getVisibleHours:function(a){var b,d,e,f=a.year(),g=a.month(),h=a.date(),i=[],j=a.utcOffset()/60;for(b=0;b<24;b++)d=c(f,g,h,b-j,0,!1),e=d.utcOffset()/60,e!==j&&(d=c(f,g,h,b-e,0,!1)),i.push(d);return i},isAfter:function(a,b){return a&&a.unix()>=b.unix()},isBefore:function(a,b){return a.unix()<=b.unix()},isSameYear:function(a,b){return a&&a.year()===b.year()},isSameMonth:function(a,b){return this.isSameYear(a,b)&&a.month()===b.month()},isSameDay:function(a,b){return this.isSameMonth(a,b)&&a.date()===b.date()},isSameHour:function(a,b){return this.isSameDay(a,b)&&a.hours()===b.hours()},isSameMinutes:function(a,b){return this.isSameHour(a,b)&&a.minutes()===b.minutes()},setParams:function(a){b=a},findFunction:function(b,c){var d=b;do{if(d=d.$parent,a.isFunction(d[c]))return d[c]}while(d.$parent);return!1},findParam:function(a,b){var c=a;do{if(c=c.$parent,c[b])return c[b]}while(c.$parent);return!1},createMoment:function(a){return b?moment.tz(a,b):moment.isMoment(a)?moment.unix(a.unix()):moment(a)},getDate:function(a,b,c){var d=!1;return b[c]&&(d=this.createMoment(b[c]),d.isValid()||(d=this.findParam(a,b[c]))&&(d=this.createMoment(d))),d},eventIsForPicker:function(b,c){return a.isArray(b)&&b.indexOf(c)>-1||b===c}}});var b=a.module("datePicker");b.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(b,c,d){function e(b,c,e,f,g){return d.template(a.extend(b,{ngModel:e,minDate:!(!f||!moment.isMoment(f))&&f.format(),maxDate:!(!g||!moment.isMoment(g))&&g.format()}),c)}function f(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(d,g,h){function i(a){d.$broadcast("pickerUpdate",m[0],{maxDate:a})}function j(a){d.$broadcast("pickerUpdate",m[1],{minDate:a})}var k=null,l=g[0].id,m=[f(),f()],n=c.createMoment,o=c.eventIsForPicker;d.dateChange=function(a,b){k&&k(a,b)},l&&d.$on("pickerUpdate",function(a,b,c){o(b,l)&&d.$broadcast("pickerUpdate",m,c)}),c.setParams(h.timezone),d.start=n(d.start),d.end=n(d.end),d.$watchGroup(["start","end"],function(a){j(a[0]),i(a[1])}),a.isDefined(h.dateChange)&&(k=c.findFunction(d,h.dateChange)),h.onSetDate="dateChange";var p='<div><table class="date-range"><tr><td valign="top">'+e(h,m[0],"start",!1,d.end)+'</td><td valign="top">'+e(h,m[1],"end",d.start,!1)+"</td></tr></table></div>",q=b(p)(d);g.append(q)}}}]);var b=a.module("datePicker");b.constant("dateTimeConfig",{template:function(a,b){return"<div "+(b?'id="'+b+'" ':"")+'date-picker="'+a.ngModel+'" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.maxDate?'max-date="'+a.maxDate+'" ':"")+(a.autoClose?'auto-close="'+a.autoClose+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.minDate?'min-date="'+a.minDate+'" ':"")+(a.partial?'partial="'+a.partial+'" ':"")+(a.step?'step="'+a.step+'" ':"")+(a.onSetDate?'date-change="'+a.onSetDate+'" ':"")+(a.ngModel?'ng-model="'+a.ngModel+'" ':"")+(a.timezone?'timezone="'+a.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),b.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(){b.find("input")[0].focus()})}}}),b.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(b,c,d,e,f,g){var h=c.find("body"),i=d("mFormat");return{require:"ngModel",scope:!0,link:function(c,d,j,k){function l(a){return i(a,v,J)}function m(a){if(a.length===v.length)return a}function n(a){F=a,j.minDate=a?a.format():a,G=moment.isMoment(a)}function o(a){H=a,j.maxDate=a?a.format():a,I=moment.isMoment(a)}function p(a){return!(f(j.ngRequired)(c)||a)}function q(){u=e.template(j)}function r(a){a.stopPropagation(),k.$pristine&&(k.$dirty=!0,k.$pristine=!1,d.removeClass("ng-pristine").addClass("ng-dirty"),w&&w.$setDirty(),k.$render())}function s(){B&&(B.remove(),B=null),E&&(E.remove(),E=null)}function t(){if(!B){if(B=b(u)(c),c.$digest(),M||(c.$on("setDate",function(a,b,c){r(a),L&&L(j.ngModel,b),A&&x[x.length-1]===c&&s()}),c.$on("hidePicker",function(){d.blur()}),c.$on("$destroy",s),M=!0),"absolute"===D){var e=a.extend(d.offset(),{height:d[0].offsetHeight});B.css({top:e.top+e.height,left:e.left,display:"block",position:D}),h.append(B)}else E=a.element("<div date-picker-wrapper></div>"),d[0].parentElement.insertBefore(E[0],d[0]),E.append(B),B.css({top:d[0].offsetHeight+"px",display:"block"});B.bind("mousedown",function(a){a.preventDefault()})}}var u,v=j.format||e.format,w=d.inheritedData("$formController"),x=f(j.views)(c)||e.views.concat(),y=j.view||x[0],z=x.indexOf(y),A=j.autoClose?f(j.autoClose)(c):e.autoClose,B=null,C=d[0].id,D=j.position||e.position,E=null,F=null,G=null,H=null,I=null,J=j.timezone||!1,K=g.eventIsForPicker,L=null,M=!1;-1===z&&x.splice(z,1),x.unshift(y),k.$formatters.push(l),k.$parsers.unshift(m),a.isDefined(j.minDate)&&(n(g.findParam(c,j.minDate)),k.$validators.min=function(a){return!!p(a)||!G||moment.isMoment(a)&&(F.isSame(a)||F.isBefore(a))}),a.isDefined(j.maxDate)&&(o(g.findParam(c,j.maxDate)),k.$validators.max=function(a){return!!p(a)||!I||moment.isMoment(a)&&(H.isSame(a)||H.isAfter(a))}),a.isDefined(j.dateChange)&&(L=g.findFunction(c,j.dateChange)),C&&c.$on("pickerUpdate",function(b,c,d){if(K(c,C))if(B);else{var f=!1;a.isDefined(d.minDate)&&(n(d.minDate),f=!0),a.isDefined(d.maxDate)&&(o(d.maxDate),f=!0),a.isDefined(d.minView)&&(j.minView=d.minView),a.isDefined(d.maxView)&&(j.maxView=d.maxView),j.view=d.view||j.view,f&&k.$validate(),a.isDefined(d.format)&&(v=j.format=d.format||e.format,k.$modelValue=-1),q()}}),d.bind("focus",t),d.bind("blur",s),q()}}}]),a.module("datePicker").run(["$templateCache",function(a){a.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks" ng-init="$index2 = $index">\r\n        <td ng-repeat="day in week">\r\n          <span\r\n            ng-class="classes[$index2][$index]"\r\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="classes[$index]"\r\n                ng-repeat="year in years"\r\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(month)"\r\n                ng-bind="month|mFormat:\'MMM\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(minute)"\r\n                ng-bind="minute|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>')}])}(angular);